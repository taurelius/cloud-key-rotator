# GitHub Actions Example

## Pre-requisites

In order to rotate a key that's stored in GitHub Actions, you'll need:

1. A GitHub API token with `repo` scope, this can be generated by logging in
to [github.com](GitHub), then creating a
[personal access token](https://github.com/settings/tokens).
1. A secret set on the repository or org in GitHub
1. Auth to actually perform the rotation operation with whichever cloud provider
you're using. This will require a service-account or user (with the
cloud-provider you're rotating with) that has the required set of permissions.
Then, auth will need to be given to `cloud-key-rotator` (usually in the form of
a .json file or env vars).

## Configuration

```json
  "AccountKeyLocations": [
    {
      "ServiceAccountName": "my_aws_machine_user",
      "GitHubActions": [
        {
          "org": "my-org-name-or-username",
          "repo": "my-repo-name" // omit for org-level secrets
        }
      ]
    }
  ],
  "Credentials": {
    "GitHubToken": "my_github_token"
  }
```

When rotating AWS keys, there are some optional fields,
`keyIDEnvVar` and `keyEnvVar`, that represent the secret names in GitHub Actions,
defaulting to values `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY`
respectively.

So, if you store your Key ID and Key values in env vars in GitHub Actions that're
named differently, you could set something like this instead:

```json
    "GitHubActions": [{
      "org": "my-org-name",
      "KeyIDEnvVar": "AWS_KEY_ID",
      "KeyEnvVar": "AWS_KEY"
    }]
```

When rotating GCP keys, to override the default GitHub Actions secret name 
(`GCLOUD_SERVICE_KEY`), you only need to override the `KeyEnvVar` value
(as only a single value, the key, is needed for GCP)

```json
    "GitHubActions": [{
      "org": "my-org-name",
      "KeyEnvVar": "GCP_KEY"
    }]
```
